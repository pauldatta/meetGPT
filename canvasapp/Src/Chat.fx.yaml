"Chat As screen.'tabletAutoLayout_HeaderMainFooter_ver1.0'":
    Fill: =RGBA(234, 234, 234, 1)
    LoadingSpinnerColor: =RGBA(164, 38, 44, 1)

    ScreenContainer As groupContainer.verticalAutoLayoutContainer:
        Height: =Parent.Height
        LayoutAlignItems: =LayoutAlignItems.Stretch
        LayoutDirection: =LayoutDirection.Vertical
        LayoutMode: =LayoutMode.Auto
        Width: =Parent.Width
        ZIndex: =1

        HeaderContainer As groupContainer.horizontalAutoLayoutContainer:
            FillPortions: =0
            Height: =40
            LayoutAlignItems: =LayoutAlignItems.Stretch
            LayoutMinHeight: =100
            LayoutMinWidth: =Parent.Width
            LayoutMode: =LayoutMode.Auto
            ZIndex: =2

            LabelAppName As label:
                Align: =Align.Center
                Color: =RGBA(255, 255, 255, 1)
                DisabledColor: =RGBA(166, 166, 166, 1)
                DisplayMode: =DisplayMode.View
                Fill: =RGBA(102, 182, 227, 1)
                FillPortions: =4
                FontWeight: =FontWeight.Semibold
                Height: =Parent.Height
                Size: =18
                Text: ="Meet GPT"
                Width: =Parent.Width
                ZIndex: =1

            LabelWelcome As label:
                Align: =Align.Center
                BorderColor: =RGBA(89, 0, 0, 1)
                Color: =RGBA(0, 0, 0, 1)
                DisabledColor: =RGBA(166, 166, 166, 1)
                DisplayMode: =DisplayMode.View
                FillPortions: =1
                Size: =11
                Text: ="Hello " & User().FullName
                ZIndex: =2

            ImageUser As image:
                BorderColor: =RGBA(89, 0, 0, 1)
                DisabledBorderColor: =RGBA(166, 166, 166, 1)
                DisabledFill: =RGBA(244, 244, 244, 1)
                Image: =User().Image
                LayoutMinHeight: =Parent.Height
                ZIndex: =3

        MainSectionContainer As groupContainer.verticalAutoLayoutContainer:
            AlignInContainer: =AlignInContainer.SetByContainer
            LayoutDirection: =LayoutDirection.Vertical
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            ZIndex: =3

            Container1_1 As groupContainer.horizontalAutoLayoutContainer:
                BorderColor: =RGBA(204, 231, 246, 1)
                BorderThickness: =1
                Fill: =RGBA(251, 251, 251, 1)
                Height: =634
                LayoutAlignItems: =LayoutAlignItems.Stretch
                LayoutMinHeight: =100
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                Width: =1311
                X: =27
                Y: =85
                ZIndex: =2

                Container2 As groupContainer.verticalAutoLayoutContainer:
                    AlignInContainer: =AlignInContainer.SetByContainer
                    FillPortions: =6
                    LayoutDirection: =LayoutDirection.Vertical
                    LayoutMinHeight: =100
                    LayoutMinWidth: =400
                    LayoutMode: =LayoutMode.Auto
                    Width: =1100
                    ZIndex: =2

                    "GalleryChat As gallery.'BrowseLayout_Flexible_SocialFeed_ver4.0'":
                        BorderColor: =RGBA(89, 0, 0, 1)
                        Default: =Last(mgpt_reponses)
                        DelayItemLoading: =true
                        Items: =mgpt_reponses
                        Layout: =Layout.Vertical
                        LayoutMinHeight: =287
                        LayoutMinWidth: =320
                        LoadingSpinner: =LoadingSpinner.Data
                        ShowNavigation: =true
                        TemplatePadding: =4
                        TemplateSize: =Min(870, Self.Height - 60)
                        ZIndex: =1

                        HtmlText3_1 As htmlViewer:
                            AutoHeight: =true
                            HtmlText: |
                                ="<div style=""margin: 12px 10px 8px 10px; width: "&(GalleryChat.Width-50)&"px; height: "&(LabelPrompt_1.Height + LabelResponse_1.Height + 35)&"px; background-color: white; box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2); border-radius:5px""></div>"
                            OnSelect: =Select(Parent)
                            Width: =632
                            Y: =15
                            ZIndex: =1

                        LabelResponse_1 As label:
                            AutoHeight: =true
                            Color: =RGBA(0, 0, 0, 1)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            DisplayMode: =DisplayMode.View
                            Height: =Self.Size * 1.8
                            OnSelect: =Select(Parent)
                            PaddingBottom: =0
                            PaddingLeft: =0
                            PaddingRight: =0
                            Text: =ThisItem.Response
                            VerticalAlign: =VerticalAlign.Top
                            Width: =GalleryChat.Width - 60
                            X: =30
                            Y: |
                                =LabelPrompt_1.Y + 50
                            ZIndex: =2

                        LabelPrompt_1 As label:
                            AutoHeight: =true
                            Color: =RGBA(0, 0, 0, 1)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            DisplayMode: =DisplayMode.View
                            Height: |
                                =Self.Size * 1.8
                            OnSelect: =Select(Parent)
                            PaddingLeft: =0
                            PaddingRight: =0
                            PaddingTop: =0
                            Text: =ThisItem.Prompt
                            VerticalAlign: =VerticalAlign.Top
                            Width: =GalleryChat.Width - 60
                            X: =30
                            Y: =41
                            ZIndex: =3

                Container4 As groupContainer.verticalAutoLayoutContainer:
                    AlignInContainer: =AlignInContainer.SetByContainer
                    LayoutDirection: =LayoutDirection.Vertical
                    LayoutMinHeight: =100
                    LayoutMinWidth: =200
                    LayoutMode: =LayoutMode.Auto
                    ZIndex: =3

                    LabelGPTParams As label:
                        Align: =Align.Center
                        AlignInContainer: =AlignInContainer.Stretch
                        BorderColor: =RGBA(89, 0, 0, 1)
                        Color: =RGBA(0, 0, 0, 1)
                        DisabledColor: =RGBA(166, 166, 166, 1)
                        DisplayMode: =DisplayMode.View
                        FontWeight: =FontWeight.Semibold
                        Size: =11
                        Text: ="GPT Parameters"
                        Width: =Container4.Width - 40
                        ZIndex: =1

                    "TabListTemperature As 'Tab list'.pcfdataset":
                        DefaultSelectedItems: |-
                            =[{name: "Creative", t: 0.85}]
                        DisplayMode: =DisplayMode.Edit
                        Height: =45
                        Items: |-
                            =[{name: "Creative", t: 0.8}, {name: "Balanced", t: 0.9}, {name: "Serious", t: 1}]
                        LayoutMinHeight: =45
                        LayoutMinWidth: =100
                        RenderSize: ='PowerApps.CoreControls.TabList.RenderSize'.Small
                        Width: =Container4.Width - 40
                        X: =0
                        Y: =0
                        ZIndex: =2

                        name1_1 As pcfDataField.textualColumn:
                            FieldDisplayName: ="name"
                            FieldName: ="name"
                            FieldType: ="s"
                            FieldVariantName: ="textualColumn"
                            Order: =1
                            ZIndex: =5

        FooterContainer1 As groupContainer.horizontalAutoLayoutContainer:
            AlignInContainer: =AlignInContainer.SetByContainer
            FillPortions: =0
            Height: =100
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            ZIndex: =4

            TextInputPrompt As text:
                AlignInContainer: =AlignInContainer.Stretch
                BorderColor: =RGBA(89, 0, 0, 1)
                BorderThickness: =2
                Clear: =true
                Color: =RGBA(0, 0, 0, 1)
                Default: =""
                DisabledBorderColor: =RGBA(166, 166, 166, 1)
                DisabledColor: =RGBA(166, 166, 166, 1)
                DisabledFill: =RGBA(244, 244, 244, 1)
                EnableSpellCheck: =true
                FillPortions: =1
                FocusedBorderThickness: =4
                Height: =80
                HintText: ="Chat with GPT"
                HoverBorderColor: =RGBA(89, 0, 0, 1)
                HoverColor: =RGBA(0, 0, 0, 1)
                HoverFill: =RGBA(222, 179, 184, 1)
                LayoutMinWidth: =Parent.Width-225
                MaxLength: =2000
                Mode: =TextMode.MultiLine
                OnChange: |
                    =Set(varPrompt, Self.Text); 
                OnSelect: =
                Size: =13
                Tooltip: ="Chat with GPT"
                ZIndex: =1

            Container7 As groupContainer.verticalAutoLayoutContainer:
                Height: =Parent.Height
                LayoutDirection: =LayoutDirection.Vertical
                LayoutMinHeight: =100
                LayoutMinWidth: =100
                LayoutMode: =LayoutMode.Auto
                ZIndex: =2

                LabelTokenCount As label:
                    BorderColor: =RGBA(89, 0, 0, 1)
                    Color: =RGBA(0, 0, 0, 1)
                    DisabledColor: =RGBA(166, 166, 166, 1)
                    Live: =Live.Assertive
                    Size: =13
                    Text: =Concatenate(Len(TextInputPrompt.Text),"/2000")
                    Tooltip: ="Prompt Token Count"
                    ZIndex: =1

                Spinner1 As Spinner:
                    DisplayMode: =DisplayMode.Edit
                    Height: =30
                    LayoutMinHeight: =200
                    LayoutMinWidth: =200
                    SpinnerSize: ='PowerApps.CoreControls.Spinner.SpinnerSize'.Tiny
                    Visible: =false
                    Width: =30
                    X: =0
                    Y: =0
                    ZIndex: =2

                ButtonCanvas1Send As Button:
                    DisplayMode: =DisplayMode.Edit
                    Height: =32
                    LayoutMinHeight: =32
                    LayoutMinWidth: =96
                    OnSelect: |-
                        =// Open AI
                        Set(
                            varGPTInstructions,
                            "You are an intelligent enterprise chat bot that business users are going to communicate with.Instructions - If you're unsure of an answer, you can say I don't know or I'm not sure"
                        );
                        Set(
                            varGPTMaxTokens,
                            1000
                        );
                        Set(
                            varGPTTemperature,
                            TabListTemperature.Selected.t
                        );
                        Set(
                            varGPTFrequencyPenalty,
                            0
                        );
                        Set(
                            varGPTPresencePenalty,
                            0
                        );
                        Set(
                            varGPTTopP,
                            0.9
                        );
                        Set(
                            varGPTStop,
                            "null"
                        );
                        
                        // Set Prompt
                        Set(varPrompt, TextInputPrompt.Text);
                        
                        // Show Spinner
                        ButtonCanvas1Send.Visible = false;
                        Spinner1.Visible = true;
                        
                        // Call flow
                        Set(GPTResponse, mgpt_getResponse.Run("Null",varGPTInstructions, varPrompt, varGPTMaxTokens, varGPTTemperature, varGPTTopP, varGPTStop));
                        
                        // Clear text
                        Select(ButtonCanvas2Clear);
                        
                        // Hide Spinner
                        ButtonCanvas1Send.Visible = true;
                        Spinner1.Visible = false;
                        
                        // Refresh data
                        Refresh(mgpt_reponses);
                    Text: ="Send"
                    Visible: =true
                    Width: =96
                    X: =0
                    Y: =0
                    ZIndex: =3

                ButtonCanvas2Clear As Button:
                    DisplayMode: =DisplayMode.Edit
                    Height: =32
                    LayoutMinHeight: =32
                    LayoutMinWidth: =96
                    OnChange: =false
                    OnSelect: =Reset(TextInputPrompt);
                    Text: ="Clear"
                    Width: =96
                    X: =0
                    Y: =0
                    ZIndex: =4

